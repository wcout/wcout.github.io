<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FLTK animated GIF display</title>
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>

<h1>FLTK GIF Animation</h1>

<p><a href="http://www.fltk.org/">FLTK</a> does not support loading/displaying animated GIF files
currently. There has been already some third party work on this subject here:</p>

<p><a href="https://ringbreak.dnd.utwente.nl/~mrjb/fltk/">KleineBre's FLTK stuff</a></p>

<p>Unfortunately there are many animated GIF's that don't play well with this solution.
So I tried to fix the bugs, but after much disappointment decided to start from scratch. I found
<a href="http://giflib.sourceforge.net/">The GIFLIB project</a>, an easy to use library to reduce
the burden of decoding the GIF's to get more quickly (and safely) to the real work of designing
the interface to FLTK.</p>

<h2>Solution 1: External Widget</h2>

<p>My first solution was an external Widget <code>Fl_Anim_GIF</code>, derived from the basic FLTK widget <code>Fl_Box</code>.
This solution works well and can be found in the folder <code>extern</code> (It will probably be not
developed further - see below).</p>

<p>But Kleine Bre's design approach to expand the <code>Fl_GIF_Image</code> class with animation capabilties
seems advantegeous. On the other hand I did not want to have <code>Fl_GIF_Image</code> load animated files
whithout being asked to. There was also a technical reason not to extend <code>Fl_GIF_Image</code>:
<code>Fl_GIF_Image</code> converts the images to <code>XPM</code> format and the transparent color is always put
at the first entry of the color table. This leads to problems when other frames of the GIF
have a different transparent color index.</p>

<h2>Solution 2: Replacement widget for current GIF class</h2>

<p>So I came up with the idea to derive a class <code>Fl_Anim_GIF_Image</code> from <code>Fl_GIF_Image</code> that
stores its images directly in RGB-format without an intermittent <code>XPM</code>.</p>

<p>This solution can be found in the folder <code>intern</code>:</p>

<p>The files there can be copied directly into the FLTK tree to replace the current GIF code.</p>

<p><code>Fl_GIF_Image.cxx</code> contains the new GIF decoding algorithm using <code>GIFLIB</code>.</p>

<p><code>fl_gif_private.H</code> 'hides' and holds together the <code>GIFLIB</code> code (or the relevant parts of
<code>GIFLIB</code>'s code for decoding).</p>

<p><code>Fl_Anim_GIF_Image.H</code> declares the new image class <code>Fl_Anim_GIF_Image</code>.</p>

<h2>Current status</h2>

<p>The current status is promising - it works well, but needs some more tests.
I will stay with <code>Solution 2</code> for now and try to improve a few aspects, but
it may take some time.</p>

<p><em>Update 2016/11/13:</em></p>

<p>A few bugs have been fixed in <code>Solution 2</code> that have not been reflected in
<code>Solution 1</code> yet.</p>

<p>Issues remaining in <code>Solution 2</code>:</p>

<ul>
<li><p>How to make it usable as <code>Fl_Shared_Image</code>? One problem is, that <code>Fl_Shared_Image</code>
works through file extension (or file header actually), so how to decide if to
create an normal GIF or an animated GIF?</p></li>
<li><p>Can the API for <code>Fl_Image()</code> derived classes be completed? E.g. how to implement
<code>Fl_Animated_GIF_Image::color_average()</code>/<code>desaturate()</code> and <code>copy()</code>?</p></li>
</ul>

<p><em>Update 2016/11/19:</em></p>

<ul>
<li><code>color_average()</code> and <code>desaturate()</code> work now</li>
<li><code>copy()</code> is hard to implement - currently I have implemented a <code>resize()</code> method
that can be used to <em>replace</em> the current image with the resized one (useful
to be called only once therefore)</li>
<li>also it works to run several instances of the <em>same</em> animation simultaneously
and to use it as tiles in <code>Fl_Tiled_Image</code></li>
</ul>

<p>Issues remaining:</p>

<ul>
<li>Round up the API
<ul>
<li>allow application controlled playback</li>
<li>specify repeat count</li>
<li>...</li>
</ul></li>
</ul>

<p><em>Update 2016/11/26:</em></p>

<ul>
<li><p>Complete code refactoring. Got rid of helper class <code>RGB_Image</code>.</p></li>
<li><p><code>copy()</code> has also been implemented now. See usage with test program
<code>animgifimage-resize</code>. Scaling large GIF's can be pretty slow though...</p></li>
</ul>

<p><em>Update 2016/12/03:</em></p>

<p>Finished <em>all</em> tasks. Solution 2 is complete now.</p>

<p><em>Update 2017/08/26:</em></p>

<p>Solution 1 (external widget) has been updated to the capabilties of the
  internal solution.</p>

<h2>Test</h2>

<p><img src="screenshots/animgif.png" alt="Screenshot of animated GIF demo running" title="Screenshot of animated GIF demo running" /></p>

<p>You can test the different solutions with the test programs in each folder.
For the <code>internal</code> approach you must have <code>FLTK</code> as source distribution to replace
the mentioned files. As said before <code>Solution 1</code> is not as advanced as <code>Solution 2</code>
because I did not develop it further after starting with <code>Solution 2</code>.</p>

<p>There are some crude scripts in the root directory that help to compile the test
programs under Linux.
(Don't use them unless you understand what you are doing...)</p>

<p>Put images into the <code>testsuite</code> folder and display all of them by starting
the test program with <code>-t</code>.</p>

<p>Or try the command line options for creating tiles, desaturate and color average.</p>

<p>Change the speed live using <code>+</code> and <code>-</code> keys.</p>

<p>Look at the minimal example program <code>animgifimage-simple.cxx</code> to get a quick idea how to
use the class.</p>

<p>Have a look at the <a href="animgif/html/class_fl___anim___g_i_f___image.html">API</a>.</p>

<h2>Resume</h2>

<p>I am not entirely convinced by the concept of <code>Solution 2</code> after all, but it is
not bad either. On the one hand is <em>cute</em> to use it as a <code>Fl_Image</code>, on the other
hand exactly therefore it seems inappropriate to put more and more playing
functionality into it.</p>

<p>Perhaps a generic <code>Fl_Animation</code> class (or whatever it may be called)
would make sense - and <em>one</em> constructor for such a class could be an
<code>Fl_Animated_GIF_Image</code> (which would then not be needed to run the animation,
but only to supply the data). Or something like that.</p>

<p><a href="https://github.com/wcout/fltk-gif-animation/archive/master.zip">GitHub tarball download</a></p>

<hr />
<p align="right"><a href="index.html">Go to start page</a></p>

</body>
</html>
